A cleanup and copy version of the codes based on Diya's work for the CCA

